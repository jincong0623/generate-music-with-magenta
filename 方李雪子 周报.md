Music Generation Using Deep Learning（翻译）
《使用深度学习产生音乐》


摘要
	使用深度学习在文学艺术领域上最近已经成了一种趋势，引起了广泛的关注，并且自动的产生音乐已经成了一活跃的领域。这个工程，用原始声音文件在频谱，依赖于很多的LSTM架构处理产生的音乐。紧密的联系和卷积层的应用通过LSTM的捕获去得到在频谱上更多的特征并且提高产生的音乐的质量。工作集中于无约束的音乐的产生，并且不用任何乐曲结构（音符或者和弦）的信息去帮助学习。从多种结构产生的音乐用蒙着眼睛的测试来比较。用未加工的音频训练模型是一个方向去给大量的mp3文件打节拍，这些文件存在于互联网而不需要人工的请求去完成构建MIDI文件。更甚，不是所有的音频文件可以被MIDI文件所代替，使这些模型的学习，有可能成为未来的这些模型。

1，介绍
	音乐的构成是一门艺术，甚至需要人的努力才能够弹奏好组合的音乐。达到复杂和抽象性的程度，设计一个算法去立刻演绎两个任务不是容易理解的，并且是无成效的结果。因此更容易的是去模仿这个是一个学习的问题，够成音乐被看做是训练数据，提取有用的音乐模式。
	我们的目标是产生听起来悦耳的音乐，但像人来那样弹奏音乐是不必要的。我们希望学习算法去找到一个音乐好听的一个空间而不用强制执行是否依照音乐的理论。由于这个原因，我们不用任何像音符，乐谱或者和弦这样的去帮助学习或者在步骤的产生上，我们直接解决最后的结果，音频波形。

	音频波形是一个空间的符号，他们不同于时间以致一个音乐碎片和上一个音乐碎片有一个平滑的过度用一个特定的迭代法，。Fig,1提供了一个简单的形象化的未加工的音频波形。一个显而易见的结构的选择去模仿一个时间的不同的功能将成为一个再度出现的神经网络，因为他可以通过时间能够分享的一个参数。特别地，我们将用LSTM网络成为信号的模型。
	
2.相关工作
用音符，和弦和乐谱这样的音乐特征，通过LSTM来产生音乐有很大的工作量。这些工作展现许诺了结果并且演示LSTM有能力去获得足够大范围的信息，这些信息是产生音乐所需要的。这些方法中的典型架构涉及到MIDI文件的音乐符号的结构化输入，这些MIDI文件被编码为向量并在每个时间步长馈入到LSTM中，并且这个继续。LSTM与指导编码的先一步和这的持续。该误差被计算为预测值的负对数损失和真实值。
这些方法消除了在产生音乐时，噪音产生的可能性，预测的音符以一对一的方式被映射到它们各自的有限音频词汇表。
因为在非常低的维度向量上进行训练，通过增加他们可以学习的时间范围，一个更高的单元可以被LSTM所负担。记录丢失的选择允许对架构更容易的进行培训。因为这些原因，这些方法能够产生非常好听的音频。然而，它们仅限于它们生成的那种音频，因为输出被限制为模型操作的低维度的输入矢量。
还有一些工作直接对原始音频样本进行建模,从使用非常深的扩展卷积网络的文件获得最好的结果，以16khz的样本一次生成样品。通过增加每个深度的扩张量，他们能够捕获长距离依赖关系，以获得音频的好的音频。很容易想象他们必须达到的深度，才能捕捉足够的时间信息，这样可以很好地编码歌曲。尽管深度河大，训练网络相对比较容易，因为将问题作为一个分类问题来处理，他们把生成的音频样本分成255个值。这允许他们使用负对数损失而不是均方损失。这降低了过度拟合到异常值的可能性，从而减少了收敛时间。虽然这种方法的话，深度使它在计算方面非常苛刻，在Google的GPU群集上产生一秒钟的音频需要大约一分钟，使我们不得不考虑一个更快的选择。
Nayebi等人最近的工作，也在音频样本上工作，而不是试图从原始音频样本学习和生成，他们在音频的频域上工作。这种方法要快得多，因为它允许网络训练和预测构成频域的一组样本，而不是单个样本。由于频域仍然可以表示所有可听见的音频信号，所以对其可以产生的音乐的种类没有限制。它们使用单个LSTM架构，其中样本在傅里叶表示下一个时间步长的信号。将预测输出与真实频率之间的均方差用作训练网络的成本函数。由于良好的结果和较低的计算需求，我们将此方法作为所有比较的基准。
我们在该方法中发现了几个缺点，尽管音频样本中存在很好的调谐，但它受到很多干扰，网络无法捕获长距离依赖性，只有在某些缺乏相干结构的区域才能使人听的愉快。已知LSTM可用于捕获[3,4,5]中的远程依赖关系，但是由于硬件限制，特别大的特征尺寸和小的单元状态大小阻止网络这样做。因此，我们改变了架构，以减轻这些问题，并产生更连贯的音乐。

3.方法
所有的方法都处理频率表示的音频样本。所使用的音频采样为16khz，我们只考虑简单的单声道音频。考虑像这样为代表的<a0,a1,a2,...an>原始音频样本，通过一次考虑n个样本来获得傅里叶变换，以获得一维向量。n维频率矢量中的每个值由实部和虚部组成，为了简化计算，向量展开为2n维向量，其中虚数附加在n个实数值之后。所有这些方法中使用的LSTM都是从中[7]前面寻常的LSTM。
其余的细节是具体的实现，在以下小节中讨论。

3.1.基线实施
我们将[1]完成的工作作为比较所有其他模型的基础。本文的实现和网络架构的相同可以在图2中看到。
Figure 2

基本模型将D维输入向量从训练集提供给LSTM，然后生成D维的频率向量作为输出。 考虑由Xt表示的频率表示，以表示第t个时间步长的频率分量。考虑T是训练期间LSTM滚动的时间步长数（这又是像细胞状态一样的超参数）。 样品Xt0至Xt0 + T作为LSTM批次中的样品以每个时间步长进给，允许LSTM生成输出Xti + 1。 计算Xti + 1和真实样本Xti + 1之间产生的均方误差，并通过LSTM反向传播。这个过程是以从Xt0 + T到Xt0开始的相反顺序在每个时间段进行的。 在预测期间，需要T时间步长的初始序列作为输入，以产生形成预测音频的第一时间步长的T + 1时间步长的输出。 该值附加到输入序列，并且对于下一个预测步骤，再次考虑该序列的最后T个步骤。 更正式地，从X0到Xt开始，预测值Xt + 1，以获得下一个预测值X1至Xt + 1，其中Xt + 1 = Xt + 1，并且重复该处理。
我们观察到，以这种方式做出的预测使得在每个时间步长上使用预测并将它们作为LSTM的输入而得到更好的声音输出。 这是因为在这种方法中，每个预测都具有来自所有T时间步长的上下文。 然而，如果我们坚持后一种方法，则第一预测值从无上下文开始，第二预测仅具有先前值的上下文等等。 用小型文字进行的预测更容易出错，并且往往是随机的，这种随机性逐渐流失，导致结果不佳。 因此，随机选择样品X0至Xt作为起始种子，并使用它们进行预测。
从实验中，我们发现D（样本维度）的最优值为8000，隐藏状态的值为2048.产生良好音乐的事实表明，2048矢量不仅拥有足够的信息，如何操作 关于当前状态，还有关于如何从不同状态进行转换的上下文信息。 单元格状态决定隐藏状态向量如何被填充以通过相关的上下文信息。 因此，通过增加细胞状态的大小可以天真地解决缺乏长距离的倾向，但是由于硬件限制，良好的增长变得不可行。
从8000维度向量减少到小于2048的空间（因为我们可以假设一些维度存储上下文信息）暗示，只有这些频率的一部分对于人类感知是必不可少的[1] 状态存储良好预测所需的频率的线性组合。 如果细胞可以代替存储频率的更复杂的表示，则需要相对较小的维度来保存该信息。 我们可以期望增加这种复杂性，而不会在性能上遭受相当大的损失，因为我们知道并不是所有的频率组件都是必不可少的。 所以如果LSTM的输入是一个复杂的频率函数，我们基本上可以把它们存储在较小的维度单元格状态，留下更多的空间存储上下文信息。这个假设的原因导致了我们第二种方法，其中包括在LSTM和输入之间增加层次，希望允许细胞状态保持更多的相互信息，从而增加远程依赖度。

3.2.将复合表示作为输入到LSTM
我们通过尝试两种不同的架构，实验证实了我们的假设，如图（3,4）所示。 由于音乐没有任何具体的结构，我们无法像Andrej Karpathy等人[6]所做的那样具体地进行测试。
Figure.3
Figure.4
架构（图3）涉及通过完全连接的层传递每个时间步长的输入，并将该层的输出馈送到LSTM。 然后使用LSTM进行预测。 整流线性单位（RELU）用作完全连接层中的非线性。 通过实验，我们发现，将完全连接的层的大小设置为等于LSTM隐藏状态的大小导致最佳预测。
查看真实音乐的光谱仪，我们可以观察各种频率之间的良好局部依赖关系，暗示可以使用卷积层代替完全连接的层，从而给出较少参数的复杂表示。 我们在输入层（参考ar-chitecture with Conv 1D和max pooling）中添加了一个最大汇总的1D卷积层，大小为1x3的12个滤波器使用了2x2的最大池。 这个操作是在每个时间步骤进行的，其输出被输入到LSTM中。 这减少了训练时间（参考图表如何减少），但是音乐产生的质量不是很好，表明频率表现出不能在视觉上观察到的非局部依赖性。
Figure 5
提高输入的复杂性不足以捕获像使用MIDI文件的重新搜索作品中观察到的远程信息，所以我们也想增加存储上下文信息的复杂性。 我们通过实现使用多个LSTMS的两种不同架构来实现。
Figure6
第一种方法包括将LSTM与第一个LSTM进行堆叠，以便在每个时间步骤中将更多信息并入隐藏状态。 第一个LSTM的输出将作为输入传递给下一个LSTM，第二个LSTM将在每个时间步长输出预测。
Figure7.双线性对齐中的LSTM
在第二种方法中，构建双线性模型，如图（参考图）所示，其中两个LSTM在每个时间步长读取完全连接的层的输入，并且合并的输出被馈送到完全连接的层。 合并层只是将两个层的结果相加，并将其馈送到完全连接的层，然后进行预测。 总和操作允许梯度在反向传播期间容易流动。 两个LSTM都是随机初始化的，所以这两种细胞状态都被迫学习不同的表示。
双线性模型背后的直觉可以由以下事实来考虑：由于每个LSTM只能与单个LSTM模块需要学习的功能相比只能学习一部分功能，因此架构允许LSTM并行学习更快，并且共享 相互参数。 我们还尝试了具有非常低的尺寸单元状态（由于硬件约束）的堆叠LSTM模型的集合，没有任何令人信服的结果。

3.4.增加卷积以增加范围
我们想探讨如果我们能进一步增加LSTM考虑的上下文范围。 我们观察到当LSTM用MIDI文件训练时，LSTM的每个步骤都会接收到一个换算为大约0.5秒的信息或更多的符号。我们假设如果LSTM可以在较大的时间实例上一次操作，那么 更容易记住状态，因为它可以依赖于很多上下文来从输入本身。 然而，直接使用频域超过0.5秒的音频会导致无法训练的16000维矢量，因为它需要更高的单元状态大小和更多的内存。 而是采取图8所示的架构。
Figure8.以单个时间步长提供N个样本的K个块。
在这种方法中，输入表示是稍微修改的，创建频率表示的两个信道，其中第一个信道保持实际值，第二个信道保持虚数值，创建一个双信道的N维矩阵。 一次只考虑一组N个样本，而不是每个时间步长考虑K个这样的两个通道的N维向量。 这些组按顺序堆叠创建具有两个通道的KxN图像，其中LSTM在每个时间步长生成第（k + 1）个样本作为输出。 图像（参考使用的图像）非常类似于生成分光镜的过程。 这被馈送到卷积网络，其输出被馈送到执行预分析的LSTM。 CNN在这里使用这些图像的空间信息并以LSTM的压缩表示形式进行分析，这样我们可以在单个时间步长的0.75秒内将信息提供给LSTM。

4.实验
作为数据集收集的一部分，从网站http：== orangefreesounds作为mp3文件刮下钢琴曲调。 然后将这些文件转换为使用ffmpeg以16KHz采样的单声道wav文件。 数据集包括25个钢琴曲调，持续时间在2分钟到3分钟之间。 收集集中的20首歌曲被随机挑选为训练阶段，剩余的5首歌曲被用作预测的随机起始种子。 为了构建适合这些模型的数据集，每个歌曲以0.25秒采样，并使用傅里叶变换转换为频域，以获得4000个频率分量。 每个频率分量由实部和虚部组成，当展开时，我们给出一个8000维度向量，其中虚数值附加到实际值。
8000维度向量在每个时间步长形成模型的输入。 该模型已被训练为每次迭代使用40个时间标记的信息，从而允许10秒的信息由模型处理。 每个音频文件被分割成10秒的间隔，给出近300个用于训练模型的样本。
这些模型使用带有TensorFLow框架的Keras包装器作为后端运行在Nvidia GTX960M GPU上的模型。
每个模型使用rmsprop优化器训练2000个时期，学习率为0.0001。 平均误差函数用于设计所有型号的损耗函数。 对于使用L2正则化和退出的模型组合中的完全连接的层。 用0.0001进行L2值测试，退化值为0.2。 对于LSTM模型，剔除0.5用于为隐藏状态权重矩阵和输入权重矩阵提供正则化。 下面的时间表显示关于时代的训练损失的下降：
Figure9 双线性LSTM的损失图
所有实现的损耗图看起来非常相似，它们在决定生成音乐的质量方面起不到任何作用，它们仅用于帮助选择网络的超参数。
每个经过训练的模型然后经受预测阶段，其中模型被馈送来自测试集的随机序列以产生具有在不同时期产生的权重的10秒音频剪辑。 样品在1200，1500，1800和2100纪元生成，以挑选最好的模型。 然后手动修剪生成的剪辑，以创建来自不同模型的合理音频的群集。	
盲测方法用于收集生成的音频样本的评级。 从不同的模型收集了30个音频样本，并提供给10个测试人员，以1到5的比例为每个音频样本提供评分。所获得的聚合结果可以在表1中找到。
所有提出的模型显示出优于[1]中提出的基本模型，双线性模型提供了所有模型的最佳输出样本。 双线性模型允许LSTM从头开始并行学习，通过实现其他模型的性能，例如具有较低数量时期的FC层的RNN。 由于LSTM在双线性模型中的输出得到总结，每个LSTM可以收敛速度更快，从数据集中捕获更多的特征。
多层LSTM模型，具有完全连接层的单个LSTM和具有卷积层的单个LSTM都优于基本模型。 这可以归功于所有这些模式都具有比基准更多的参数，从而允许模型从有限的训练数据中更好地学习。
虽然钢琴曲调用于训练模型，但是模型的预期输出不是生成钢琴曲调。 期望是产生一种令人愉悦的耳朵，这种音频可能是或不是内在的音调。 该模型使用其在不同频率上传播信息的能力来艺术地综合使用多个频率和变化幅度的组合电子地生成的音调。

5. 结论
研究的模型显示，音乐转换器的性能提高了对适合原始音频表现的架构的更多洞察。 双线性体系结构和LSTM与两个解决方案产生了测试模型的音质。 将来，我们希望调查将损失函数从MSE更改为使用对抗网络的选项，并允许网络根据自己的需要对自己的损失函数进行建模，从而可以代表人们如何看待音乐。

6.参考文献










